<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Terra Numerica - Atelier Graphes</title>
  <script src="https://unpkg.com/cytoscape@3.26.0/dist/cytoscape.min.js"></script>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <header id="tn-header">
    <div class="tn-container">
      <div class="tn-logo">
        <img src="public/terra_numerica_logo.png" alt="Terra Numerica">
      </div>
      <nav class="tn-nav">
        <a href="#" class="active">L'Atelier Graphes</a>
        <a href="https://terra-numerica.org/" target="_blank">Retour au site</a>
      </nav>
    </div>
  </header>

  <main class="grid">
    <section id="zone-3">
      <div>
        <h1>Consignes</h1>
        <p>
          Choisis un <strong>mode</strong> : <em>PersonnalisÃ©</em> ou <em>Niveaux</em>.<br>
          CrÃ©ez, modifiez et explorez les graphes k-partites.
        </p>
      </div>
      <div id="zone-4">
        <button class="info-btn" id="openHelp" aria-label="Informations">i</button>
      </div>
    </section>

    <section id="zone-1" aria-label="Zone graphe">
      <div id="cy" role="application" aria-label="Graphe Cytoscape"></div>
    </section>

    <aside id="zone-2" aria-label="Panneau de contrÃ´le">
      <div class="card">
        <h3>Mode</h3>
        <div class="row">
          <select id="mode" style="width:100%">
            <option value="editor" selected>Ã‰diteur de graphe</option>
            <option value="levels">Niveaux</option>
            <option value="templates">Templates</option>
          </select>
        </div>

        <div id="editor-controls" class="editor-panel">
          <h3>CrÃ©ation</h3>
          <div class="row gap-sm">
            <input type="number" id="nodePart" min="1" max="10" value="1" style="width:50px" title="NumÃ©ro de partie">
            <input type="text" id="nodeLabel" placeholder="Nom du nÅ“ud" style="flex:1">
          </div>
          <button class="primary" id="btnAddNode" style="width:100%; margin-top:8px">Ajouter un nÅ“ud</button>

          <h3>Fichier</h3>
          <div class="row" style="gap:6px">
            <button class="secondary" id="btnExportJSON" style="flex:1">Exporter</button>
            <button class="secondary" id="btnImportJSON" style="flex:1">Importer</button>
          </div>
          <input type="file" id="fileInput" accept=".json" style="display:none">
          
          <div class="row" style="margin-top:10px">
             <button class="ghost" id="btnClear" style="width:100%">Tout effacer</button>
          </div>
        </div>

        <div id="level-controls" class="hidden" style="margin-top:10px">
          <h3>Choix du niveau</h3>
          <select id="level" style="width:100%; margin-bottom:8px"></select>
          <button class="primary" id="btnLoadLevel" style="width:100%">Charger le niveau</button>
        </div>

        <div id="template-controls" class="hidden" style="margin-top:10px">
          <h3>Choix du modÃ¨le</h3>
          <select id="template" style="width:100%; margin-bottom:8px">
            <option value="">-- SÃ©lectionner --</option>
            <option value="k3_3">K3,3 (Bipartite complet)</option>
            <option value="k3_3_3">K3,3,3 (Tripartite complet)</option>
            <option value="k3_3_3_3">K3,3,3,3 (Quadripartite complet)</option>
          </select>
          <button class="primary" id="btnLoadTemplate" style="width:100%">Charger le modÃ¨le</button>
        </div>
      </div>

      <div class="card">
        <h3>Outils</h3>
        <p id="stats" class="hint" style="margin-bottom:10px; text-align:center">â€”</p>
        
        <div class="row" style="margin-bottom:8px">
             <button id="btnEdgeColor" class="color-cycle color-grey" style="width:100%">Couleur : Gris</button>
        </div>
        
        <button class="ghost" id="btnPotential" style="width:100%; margin-bottom:8px">Voir arÃªtes possibles</button>
        
        <div class="row">
          <button id="btnLayout" class="ghost" style="flex:1">RÃ©organiser</button>
          <button id="btnFit" class="ghost" style="flex:1">Centrer</button>
        </div>
        
        <div class="row" style="margin-top:15px">
          <button id="btnDeleteNode" class="danger" style="width:100%">Supprimer la sÃ©lection</button>
        </div>
        <button id="btnRandom" style="display:none"></button>
      </div>
    </aside>
  </main>

  <dialog id="win-dialog">
    <div class="modal-header win-header">
      <strong>ğŸ‰ Niveau TerminÃ© !</strong>
      <button class="info-btn" id="closeWin" aria-label="Fermer" style="background:transparent; border:1px solid white;">Ã—</button>
    </div>
    <div class="modal-body">
      <div style="text-align: center; margin-bottom: 20px;">
        <span style="font-size: 40px;">ğŸ†</span>
        <h2 style="margin: 10px 0; color: var(--success);">Bravo !</h2>
        <p id="win-message">Tu as trouvÃ© la solution.</p>
      </div>

      <div class="pedago-box">
        <h3>ğŸ’¡ Le point Savant</h3>
        <p id="pedago-text">Explication pÃ©dagogique...</p>
      </div>

      <div class="row" style="margin-top: 20px; justify-content: center;">
        <button class="secondary" id="btnReplayModal">ğŸ”„ Rejouer</button>
        <button class="ghost" id="btnCloseModal">Fermer</button>
      </div>
    </div>
  </dialog>

  <dialog id="help">
    <div class="modal-header">
      <strong>Guide d'utilisation</strong>
      <button class="info-btn" id="closeHelp" aria-label="Fermer" style="background:transparent; border:1px solid white;">Ã—</button>
    </div>
    <div class="modal-body">
      <h3 style="margin-top:0">ğŸ‘‹ Bienvenue sur l'Atelier Graphes</h3>
      <p>Cette application vous permet de manipuler des graphes aux couleurs de <strong>Terra Numerica</strong>.</p>

      <h3>ğŸ› ï¸ FonctionnalitÃ©s ClÃ©s</h3>
      
      <p><strong>ğŸŸ¢ğŸ”´ Gestion des Couleurs</strong><br>
      Utilisez le bouton "Couleur" (Ã  droite) pour :
      <ul>
        <li>Choisir la couleur des <em>prochaines</em> arÃªtes que vous tracerez.</li>
        <li>Changer la couleur des arÃªtes dÃ©jÃ  <em>sÃ©lectionnÃ©es</em> (elles se dÃ©sÃ©lectionnent ensuite pour afficher le rÃ©sultat).</li>
      </ul>
      <em>Astuce : Utilisez le Vert pour "sÃ»r" et le Rouge pour "impossible".</em></p>

      <p><strong>ğŸ“ ModÃ¨les GÃ©omÃ©triques</strong><br>
      Les templates complets s'organisent automatiquement :
      <ul>
        <li><strong>K3,3</strong> (Bipartite) â†’ Colonnes</li>
        <li><strong>K3,3,3</strong> (Tripartite) â†’ Triangle</li>
        <li><strong>K3,3,3,3</strong> (Quadripartite) â†’ CarrÃ©</li>
      </ul>
      Cliquez sur <strong>"RÃ©organiser"</strong> pour retrouver ces formes parfaites.</p>

      <h3>ğŸš€ Comment jouer ?</h3>
      
      <h4>Mode Ã‰diteur</h4>
      <ul>
        <li><strong>Ajouter :</strong> Remplissez Partie/Label puis "Ajouter" (ou EntrÃ©e).</li>
        <li><strong>Lier :</strong> Cliquez sur un premier nÅ“ud, puis sur un second.</li>
        <li><strong>Supprimer :</strong> Double-clic sur une arÃªte, ou sÃ©lection + bouton "Supprimer".</li>
      </ul>

      <h4>Mode Niveaux</h4>
      <ol>
        <li>Choisissez une Ã©nigme (ex: Motos).</li>
        <li>Lisez les indices en haut.</li>
        <li>Utilisez le bouton <strong>"Voir arÃªtes possibles"</strong> pour afficher en gris ce qu'il reste Ã  tester.</li>
      </ol>

      <h3>ğŸ’¾ Sauvegarde</h3>
      <p>Utilisez les boutons <strong>Exporter / Importer JSON</strong> pour sauvegarder votre progression.</p>
      
      <hr style="margin: 20px 0; border: 0; border-top: 1px solid #eee;">
      <p style="text-align: center; font-style: italic; color: #666; font-size: 12px;">Application dÃ©veloppÃ©e pour Terra Numerica.</p>
    </div>
  </dialog>

  <script src="niveau1.js"></script>
  <script src="niveau2.js"></script>
  <script src="niveau3.js"></script>
  <script src="niveau4.js"></script>
  <script src="niveau5.js"></script>
  <script src="niveau6.js"></script>
  <script src="script.js"></script>

</body>
</html>